<form action="/submit-seguridad" method="post">
    <label for="name">Nombre completo:</label>
    <input type="text" id="name" name="name" required><br>
    
    <label for="location">Dirección:</label>
    <input type="text" id="location" name="location" required><br>
    
    <label for="description">Descripción de la situación:</label>
    <textarea id="description" name="description" required></textarea><br>
    
    <label for="evidence">Evidencia:</label>
    <input type="file" id="evidence" name="evidence"><br>
    
    <label for="urgency">Nivel de urgencia:</label>
    <select id="urgency" name="urgency">
      <option value="alta">Alta</option>
      <option value="media">Media</option>
      <option value="baja">Baja</option>
    </select><br>
    
    <button type="submit">Enviar</button>
  </form>

  <script>
    const startChat = require('../gemminiConnection');
    const { insertFormData } = require('../mongoConnection');

    document.querySelector('form').addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent form submission for testing
        const userPrompt = "Provide details for the security form"; // Customize the prompt
        try {
            const formData = await startChat(userPrompt);
            document.getElementById('name').value = formData.name || '';
            document.getElementById('location').value = formData.location || '';
            document.getElementById('description').value = formData.description || '';
            document.getElementById('urgency').value = formData.urgency || 'media';
        } catch (error) {
            console.error("Error populating the form:", error);
        }

        const formDataToSubmit = {
            name: document.getElementById('name').value,
            location: document.getElementById('location').value,
            description: document.getElementById('description').value,
            urgency: document.getElementById('urgency').value
        };

        try {
            const result = await insertFormData("Seguridad", formDataToSubmit);
            alert("Form data submitted successfully!");
        } catch (error) {
            console.error("Error submitting form data:", error);
            alert("Failed to submit form data.");
        }
    });
</script>
