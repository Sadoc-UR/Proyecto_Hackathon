<form action="/submit-saludpublica" method="post">
    <label for="name">Nombre completo:</label>
    <input type="text" id="name" name="name" required><br>
    
    <label for="location">Ubicaci√≥n:</label>
    <input type="text" id="location" name="location" required><br>
    
    <label for="emergency">Tipo de emergencia:</label>
    <input type="text" id="emergency" name="emergency" required><br>
    
    <label for="contact">Contacto:</label>
    <input type="tel" id="contact" name="contact" required><br>
    
    <label for="status">Estado del paciente:</label>
    <textarea id="status" name="status" required></textarea><br>
    
    <button type="submit">Enviar</button>
  </form>

  <script>
    const startChat = require('../gemminiConnection');
    const { insertFormData } = require('../mongoConnection');

    document.querySelector('form').addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent form submission for testing
        const userPrompt = "Provide details for the health form"; // Customize the prompt
        try {
            const formData = await startChat(userPrompt);
            document.getElementById('name').value = formData.name || '';
            document.getElementById('location').value = formData.location || '';
            document.getElementById('emergency').value = formData.emergency || '';
            document.getElementById('contact').value = formData.contact || '';
            document.getElementById('status').value = formData.status || '';
        } catch (error) {
            console.error("Error populating the form:", error);
        }

        const formDataToSubmit = {
            name: document.getElementById('name').value,
            location: document.getElementById('location').value,
            emergency: document.getElementById('emergency').value,
            contact: document.getElementById('contact').value,
            status: document.getElementById('status').value
        };

        try {
            const result = await insertFormData("Salud", formDataToSubmit);
            alert("Form data submitted successfully!");
        } catch (error) {
            console.error("Error submitting form data:", error);
            alert("Failed to submit form data.");
        }
    });
</script>

