<form action="/submit-transito" method="post">
    <label for="name">Nombre completo:</label>
    <input type="text" id="name" name="name" required><br>
    
    <label for="date">Fecha y hora:</label>
    <input type="datetime-local" id="date" name="date" required><br>
    
    <label for="incident">Descripción del incidente:</label>
    <textarea id="incident" name="incident" required></textarea><br>
    
    <label for="vehicle">Tipo de vehículo involucrado:</label>
    <input type="text" id="vehicle" name="vehicle"><br>
    
    <label for="witness">Testigos:</label>
    <input type="text" id="witness" name="witness"><br>
    
    <button type="submit">Enviar</button>
  </form>

  <script>
    const startChat = require('../gemminiConnection');
    const { insertFormData } = require('../mongoConnection');

    document.querySelector('form').addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent form submission for testing
        const userPrompt = "Provide details for the traffic form"; // Customize the prompt
        try {
            const formData = await startChat(userPrompt);
            document.getElementById('name').value = formData.name || '';
            document.getElementById('date').value = formData.date || '';
            document.getElementById('incident').value = formData.incident || '';
            document.getElementById('vehicle').value = formData.vehicle || '';
            document.getElementById('witness').value = formData.witness || '';
        } catch (error) {
            console.error("Error populating the form:", error);
        }

        const formDataToSubmit = {
            name: document.getElementById('name').value,
            date: document.getElementById('date').value,
            incident: document.getElementById('incident').value,
            vehicle: document.getElementById('vehicle').value,
            witness: document.getElementById('witness').value
        };

        try {
            const result = await insertFormData("Transito", formDataToSubmit);
            alert("Form data submitted successfully!");
        } catch (error) {
            console.error("Error submitting form data:", error);
            alert("Failed to submit form data.");
        }
    });
</script>
