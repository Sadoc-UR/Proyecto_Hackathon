<form action="/submit-infraestructura" method="post">
    <label for="name">Nombre completo:</label>
    <input type="text" id="name" name="name" required><br>
    
    <label for="location">Ubicación:</label>
    <input type="text" id="location" name="location" required><br>
    
    <label for="type">Tipo de infraestructura afectada:</label>
    <input type="text" id="type" name="type"><br>
    
    <label for="description">Descripción del problema:</label>
    <textarea id="description" name="description" required></textarea><br>
    
    <label for="priority">Prioridad:</label>
    <select id="priority" name="priority">
      <option value="alta">Alta</option>
      <option value="media">Media</option>
      <option value="baja">Baja</option>
    </select><br>
    
    <button type="submit">Enviar</button>
  </form>

  <script>
    const startChat = require('../gemminiConnection');
    const { insertFormData } = require('../mongoConnection');

    document.querySelector('form').addEventListener('submit', async (event) => {
        event.preventDefault(); // Prevent form submission for testing
        const userPrompt = "Provide details for the infrastructure form"; // Customize the prompt
        try {
            const formData = await startChat(userPrompt);
            document.getElementById('name').value = formData.name || '';
            document.getElementById('location').value = formData.location || '';
            document.getElementById('type').value = formData.type || '';
            document.getElementById('description').value = formData.description || '';
            document.getElementById('priority').value = formData.priority || 'media';
        } catch (error) {
            console.error("Error populating the form:", error);
        }

        const formDataToSubmit = {
            name: document.getElementById('name').value,
            location: document.getElementById('location').value,
            type: document.getElementById('type').value,
            description: document.getElementById('description').value,
            priority: document.getElementById('priority').value
        };

        try {
            const result = await insertFormData("Infraestructura", formDataToSubmit);
            alert("Form data submitted successfully!");
        } catch (error) {
            console.error("Error submitting form data:", error);
            alert("Failed to submit form data.");
        }
    });
</script>

